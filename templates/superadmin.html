{% extends "base.html" %}

{% block title %}Super Admin - Carnet d'Adresses{% endblock %}

{% block content %}
<div class="content-container">
    <div class="page-header">
        <h1>âš™ï¸ Panneau Super Administrateur</h1>
        <a href="{{ url_for('contacts') }}" class="btn btn-secondary">â† Retour aux contacts</a>
    </div>
    
    <div class="superadmin-dashboard">
        <!-- Statistiques de la base de donnÃ©es -->
        <div class="dashboard-section">
            <h2>ğŸ“Š Statistiques de la Base de DonnÃ©es</h2>
            <div class="stats-grid">
                <div class="stat-card-small">
                    <div class="stat-icon">ğŸ“‡</div>
                    <div class="stat-value">{{ db_stats.total }}</div>
                    <div class="stat-label">Contacts Total</div>
                </div>
                
                <div class="stat-card-small">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <div class="stat-value">{{ total_users }}</div>
                    <div class="stat-label">Utilisateurs</div>
                </div>
                
                <div class="stat-card-small">
                    <div class="stat-icon">âš¡</div>
                    <div class="stat-value">{{ users_by_role.get('super_admin', 0) }}</div>
                    <div class="stat-label">Super Admins</div>
                </div>
                
                <div class="stat-card-small">
                    <div class="stat-icon">ğŸ‘®</div>
                    <div class="stat-value">{{ users_by_role.get('admin', 0) }}</div>
                    <div class="stat-label">Administrateurs</div>
                </div>
            </div>
        </div>
        
        <!-- Gestion de la base de donnÃ©es -->
        <div class="dashboard-section danger-zone">
            <h2>ğŸ—„ï¸ Gestion de la Base de DonnÃ©es</h2>
            
            <div class="db-actions">
                <div class="action-card">
                    <h3>ğŸ’¾ Sauvegarde</h3>
                    <p>CrÃ©er une copie de sauvegarde de la base de donnÃ©es</p>
                    <a href="{{ url_for('backup_database') }}" class="btn btn-primary">
                        ğŸ’¾ CrÃ©er une sauvegarde
                    </a>
                </div>
                
                <div class="action-card danger">
                    <h3>âš ï¸ Zone Dangereuse</h3>
                    <p><strong>ATTENTION:</strong> Cette action est irrÃ©versible!</p>
                    <button type="button" class="btn btn-danger" onclick="showDeleteConfirmation()">
                        ğŸ—‘ï¸ Effacer toute la base de donnÃ©es
                    </button>
                </div>
            </div>
        </div>
        
        <!-- RÃ©partition des contacts par utilisateur -->
        <div class="dashboard-section">
            <h2>ğŸ“ˆ RÃ©partition des Contacts</h2>
            {% if db_stats.par_utilisateur %}
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Utilisateur</th>
                        <th>Nombre de Contacts</th>
                        <th>Pourcentage</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user, count in db_stats.par_utilisateur.items() %}
                    <tr>
                        <td>{{ user }}</td>
                        <td>{{ count }}</td>
                        <td>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ (count / db_stats.total * 100)|round(1) }}%"></div>
                                <span class="progress-text">{{ (count / db_stats.total * 100)|round(1) }}%</span>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="text-muted">Aucune donnÃ©e disponible</p>
            {% endif %}
        </div>
        
        <!-- Actions rapides -->
        <div class="dashboard-section">
            <h2>âš¡ Actions Rapides</h2>
            <div class="quick-actions">
                <a href="{{ url_for('admin_panel') }}" class="action-btn">
                    <span class="action-icon">ğŸ‘¥</span>
                    <span class="action-text">GÃ©rer les utilisateurs</span>
                </a>
                <a href="{{ url_for('statistics') }}" class="action-btn">
                    <span class="action-icon">ğŸ“Š</span>
                    <span class="action-text">Voir les statistiques</span>
                </a>
                <a href="{{ url_for('create_user') }}" class="action-btn">
                    <span class="action-icon">â•</span>
                    <span class="action-text">CrÃ©er un utilisateur</span>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Modal de confirmation de suppression -->
<div id="deleteModal" class="modal" style="display: none;">
    <div class="modal-content">
        <h2>âš ï¸ Confirmation Requise</h2>
        <p><strong>ATTENTION:</strong> Vous Ãªtes sur le point d'effacer TOUTES les donnÃ©es de la base de donnÃ©es!</p>
        <p>Cette action est <strong>IRRÃ‰VERSIBLE</strong>.</p>
        <p>Pour confirmer, tapez exactement: <code>DELETE ALL DATA</code></p>
        
        <form method="POST" action="{{ url_for('clear_database') }}">
            <div class="form-group">
                <input type="text" name="confirmation" id="confirmationInput" 
                       placeholder="Tapez DELETE ALL DATA" 
                       class="form-control" required>
            </div>
            <div class="modal-actions">
                <button type="submit" class="btn btn-danger">ğŸ—‘ï¸ Confirmer la suppression</button>
                <button type="button" class="btn btn-secondary" onclick="hideDeleteConfirmation()">âœ— Annuler</button>
            </div>
        </form>
    </div>
</div>

<script>
function showDeleteConfirmation() {
    document.getElementById('deleteModal').style.display = 'flex';
}

function hideDeleteConfirmation() {
    document.getElementById('deleteModal').style.display = 'none';
    document.getElementById('confirmationInput').value = '';
}

// Fermer le modal en cliquant en dehors
window.onclick = function(event) {
    const modal = document.getElementById('deleteModal');
    if (event.target == modal) {
        hideDeleteConfirmation();
    }
}
</script>
{% endblock %}
