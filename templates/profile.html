{% extends "base.html" %}

{% block title %}Mon Profil - Cabinet MÃ©dical{% endblock %}

{% block content %}
<div class="content-container">
    <div class="page-header">
        <h1>ğŸ‘¤ Mon Profil</h1>
        {% if user_role == 'user' %}
        <a href="{{ url_for('patient_dashboard') }}" class="btn btn-secondary">â† Retour au Dashboard</a>
        {% else %}
        <a href="{{ url_for('contacts') }}" class="btn btn-secondary">â† Retour</a>
        {% endif %}
    </div>
    
    <div class="profile-container">
        <div class="profile-info">
            <h2>ğŸ“‹ Informations du Compte</h2>
            <div class="info-grid">
                <div class="info-item">
                    <strong>Nom d'utilisateur:</strong>
                    <span>{{ username }}</span>
                </div>
                <div class="info-item">
                    <strong>RÃ´le:</strong>
                    {% if user_role == 'super_admin' %}
                    <span class="role-badge super-admin">{{ role_name }}</span>
                    {% elif user_role == 'admin' %}
                    <span class="role-badge admin">{{ role_name }}</span>
                    {% else %}
                    <span class="role-badge user">{{ role_name }}</span>
                    {% endif %}
                </div>
            </div>
        </div>
        
        {% if user_role == 'user' and contact %}
        <!-- Section Informations Contact (pour USER uniquement) -->
        {% set categorie = user_category or contact.categorie or 'Patient' %}
        <div class="profile-actions">
            <h2>
                {% if categorie == 'Patient' %}
                ğŸ¥ Mes Informations Patient
                {% elif categorie == 'Pharmacie' %}
                ğŸ’Š Informations de la Pharmacie
                {% elif categorie == 'Laboratoire' %}
                ğŸ”¬ Informations du Laboratoire
                {% elif categorie == 'Assurance' %}
                ğŸ›¡ï¸ Informations de l'Assurance
                {% elif categorie in ['Entreprise', 'Client', 'Fournisseur', 'Partenaire'] %}
                ğŸ¢ Mes Informations Professionnelles
                {% else %}
                ğŸ“‹ Mes Informations
                {% endif %}
            </h2>
            <form method="POST" action="{{ url_for('profile') }}">
                <input type="hidden" name="action" value="contact_info">
                
                <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <strong>â„¹ï¸ Information :</strong> 
                    {% if categorie == 'Patient' %}
                    Vous pouvez modifier vos informations mÃ©dicales.
                    {% else %}
                    Vous pouvez modifier vos informations.
                    {% endif %}
                    Pour modifier votre nom, email ou tÃ©lÃ©phone, contactez l'administration.
                </div>
                
                <div class="form-group">
                    <label>
                        {% if categorie == 'Patient' %}
                        ğŸ‘¤ Nom Complet
                        {% elif categorie == 'Pharmacie' %}
                        ğŸ’Š Nom de la Pharmacie
                        {% elif categorie == 'Laboratoire' %}
                        ğŸ”¬ Nom du Laboratoire
                        {% elif categorie == 'Assurance' %}
                        ğŸ›¡ï¸ Nom de l'Assurance
                        {% elif categorie in ['Entreprise', 'Client', 'Fournisseur', 'Partenaire'] %}
                        ğŸ¢ Nom de l'Organisation
                        {% else %}
                        ğŸ‘¤ Nom
                        {% endif %}
                    </label>
                    <input type="text" value="{{ contact.nom }}" readonly style="background-color: #f5f5f5; cursor: not-allowed;">
                </div>
                
                <div class="form-group">
                    <label>ğŸ“§ Email</label>
                    <input type="email" value="{{ contact.email }}" readonly style="background-color: #f5f5f5; cursor: not-allowed;">
                </div>
                
                <div class="form-group">
                    <label>ğŸ“± TÃ©lÃ©phone</label>
                    <input type="tel" value="{{ contact.telephone }}" readonly style="background-color: #f5f5f5; cursor: not-allowed;">
                </div>
                
                <hr style="margin: 30px 0;">
                
                {% if categorie == 'Patient' %}
                <h3>Informations MÃ©dicales (Modifiables)</h3>
                
                <div class="form-group">
                    <label for="date_naissance">ğŸ‚ Date de Naissance</label>
                    <input type="date" id="date_naissance" name="date_naissance" value="{{ contact.date_naissance or '' }}">
                </div>
                
                <div class="form-group">
                    <label for="groupe_sanguin">ğŸ©¸ Groupe Sanguin</label>
                    <select id="groupe_sanguin" name="groupe_sanguin">
                        <option value="">-- SÃ©lectionner --</option>
                        <option value="A+" {% if contact.groupe_sanguin == 'A+' %}selected{% endif %}>A+</option>
                        <option value="A-" {% if contact.groupe_sanguin == 'A-' %}selected{% endif %}>A-</option>
                        <option value="B+" {% if contact.groupe_sanguin == 'B+' %}selected{% endif %}>B+</option>
                        <option value="B-" {% if contact.groupe_sanguin == 'B-' %}selected{% endif %}>B-</option>
                        <option value="AB+" {% if contact.groupe_sanguin == 'AB+' %}selected{% endif %}>AB+</option>
                        <option value="AB-" {% if contact.groupe_sanguin == 'AB-' %}selected{% endif %}>AB-</option>
                        <option value="O+" {% if contact.groupe_sanguin == 'O+' %}selected{% endif %}>O+</option>
                        <option value="O-" {% if contact.groupe_sanguin == 'O-' %}selected{% endif %}>O-</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="numero_secu">ğŸ”¢ NumÃ©ro de SÃ©curitÃ© Sociale</label>
                    <input type="text" id="numero_secu" name="numero_secu" value="{{ contact.numero_secu or '' }}" maxlength="15">
                </div>
                
                <div class="form-group">
                    <label for="allergies">âš ï¸ Allergies</label>
                    <textarea id="allergies" name="allergies" rows="3" placeholder="Ex: PÃ©nicilline, Arachides, etc.">{{ contact.allergies or '' }}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="notes">ğŸ“ Notes MÃ©dicales</label>
                    <textarea id="notes" name="notes" rows="4" placeholder="Informations mÃ©dicales additionnelles...">{{ contact.notes or '' }}</textarea>
                </div>
                
                {% elif categorie == 'Pharmacie' %}
                <h3>Informations SpÃ©cifiques Pharmacie (Modifiables)</h3>
                
                <div class="form-group">
                    <label for="date_naissance">ğŸ• Horaires d'Ouverture</label>
                    <input type="text" id="date_naissance" name="date_naissance" value="{{ contact.date_naissance or '' }}" placeholder="Ex: Lun-Ven 8h-20h, Sam 9h-18h">
                </div>
                
                <div class="form-group">
                    <label for="numero_secu">ğŸ“œ NÂ° Licence/AgrÃ©ment</label>
                    <input type="text" id="numero_secu" name="numero_secu" value="{{ contact.numero_secu or '' }}" maxlength="50" placeholder="NumÃ©ro d'autorisation officiel">
                </div>
                
                <div class="form-group">
                    <label for="allergies">ğŸ’Š Services Disponibles</label>
                    <textarea id="allergies" name="allergies" rows="3" placeholder="Ex: Garde 24h, OrthopÃ©die, HomÃ©opathie, MatÃ©riel mÃ©dical">{{ contact.allergies or '' }}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="notes">ğŸ“ Notes</label>
                    <textarea id="notes" name="notes" rows="4" placeholder="Informations complÃ©mentaires sur la pharmacie...">{{ contact.notes or '' }}</textarea>
                </div>
                
                {% elif categorie == 'Laboratoire' %}
                <h3>Informations SpÃ©cifiques Laboratoire (Modifiables)</h3>
                
                <div class="form-group">
                    <label for="date_naissance">â±ï¸ DÃ©lai de RÃ©sultats</label>
                    <input type="text" id="date_naissance" name="date_naissance" value="{{ contact.date_naissance or '' }}" placeholder="Ex: 24h pour analyses standard, 48h pour biologie">
                </div>
                
                <div class="form-group">
                    <label for="numero_secu">ğŸ… NÂ° d'AccrÃ©ditation</label>
                    <input type="text" id="numero_secu" name="numero_secu" value="{{ contact.numero_secu or '' }}" maxlength="50" placeholder="NumÃ©ro d'accrÃ©ditation COFRAC ou Ã©quivalent">
                </div>
                
                <div class="form-group">
                    <label for="allergies">ğŸ”¬ SpÃ©cialitÃ©s & Analyses</label>
                    <textarea id="allergies" name="allergies" rows="3" placeholder="Ex: Biochimie, HÃ©matologie, Microbiologie, PCR, Imagerie mÃ©dicale">{{ contact.allergies or '' }}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="notes">ğŸ“ Notes</label>
                    <textarea id="notes" name="notes" rows="4" placeholder="Informations complÃ©mentaires, horaires, modalitÃ©s de prÃ©lÃ¨vement...">{{ contact.notes or '' }}</textarea>
                </div>
                
                {% elif categorie == 'Assurance' %}
                <h3>Informations Contrat & Couverture (Modifiables)</h3>
                
                <div class="form-group">
                    <label for="date_naissance">ğŸ“… Date d'AdhÃ©sion</label>
                    <input type="date" id="date_naissance" name="date_naissance" value="{{ contact.date_naissance or '' }}">
                </div>
                
                <div class="form-group">
                    <label for="numero_secu">ğŸ“‹ NÂ° Police/Contrat</label>
                    <input type="text" id="numero_secu" name="numero_secu" value="{{ contact.numero_secu or '' }}" maxlength="50" placeholder="NumÃ©ro de contrat ou police d'assurance">
                </div>
                
                <div class="form-group">
                    <label for="allergies">ğŸ›¡ï¸ Type de Couverture</label>
                    <textarea id="allergies" name="allergies" rows="3" placeholder="Ex: Hospitalisation, Soins ambulatoires, Dentaire, Optique, MÃ©dicaments (taux %)">{{ contact.allergies or '' }}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="notes">ğŸ“ Notes</label>
                    <textarea id="notes" name="notes" rows="4" placeholder="Garanties spÃ©cifiques, exclusions, procÃ©dures de remboursement...">{{ contact.notes or '' }}</textarea>
                </div>
                
                {% elif categorie == 'Fournisseur' %}
                <h3>Informations Commerciales (Modifiables)</h3>
                
                <div class="form-group">
                    <label for="date_naissance">ğŸ“… Date de DÃ©but Collaboration</label>
                    <input type="date" id="date_naissance" name="date_naissance" value="{{ contact.date_naissance or '' }}">
                </div>
                
                <div class="form-group">
                    <label for="numero_secu">ğŸ¢ NÂ° RC</label>
                    <input type="text" id="numero_secu" name="numero_secu" value="{{ contact.numero_secu or '' }}" maxlength="50" placeholder="NumÃ©ro d'identification fiscale">
                </div>
                
                <div class="form-group">
                    <label for="allergies">ğŸ“¦ Produits/Services Fournis</label>
                    <textarea id="allergies" name="allergies" rows="3" placeholder="Ex: MÃ©dicaments, MatÃ©riel mÃ©dical, Fournitures bureau, Ã‰quipements">{{ contact.allergies or '' }}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="notes">ğŸ“ Notes</label>
                    <textarea id="notes" name="notes" rows="4" placeholder="Conditions de paiement, dÃ©lais de livraison, tarifs nÃ©gociÃ©s...">{{ contact.notes or '' }}</textarea>
                </div>
                
                {% elif categorie == 'Partenaire' %}
                <h3>Informations Partenariat (Modifiables)</h3>
                
                <div class="form-group">
                    <label for="date_naissance">ğŸ“… Date de DÃ©but Partenariat</label>
                    <input type="date" id="date_naissance" name="date_naissance" value="{{ contact.date_naissance or '' }}">
                </div>
                
                <div class="form-group">
                    <label for="numero_secu">ğŸ“œ NÂ° Convention/Accord</label>
                    <input type="text" id="numero_secu" name="numero_secu" value="{{ contact.numero_secu or '' }}" maxlength="50" placeholder="RÃ©fÃ©rence de la convention ou accord">
                </div>
                
                <div class="form-group">
                    <label for="allergies">ğŸ¤ Type de Partenariat</label>
                    <textarea id="allergies" name="allergies" rows="3" placeholder="Ex: RÃ©fÃ©rencement mutuel, Co-marketing, Ã‰change de services, R&D">{{ contact.allergies or '' }}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="notes">ğŸ“ Notes</label>
                    <textarea id="notes" name="notes" rows="4" placeholder="Termes du partenariat, objectifs communs, engagements...">{{ contact.notes or '' }}</textarea>
                </div>
                
                {% elif categorie in ['Entreprise', 'Client'] %}
                <h3>Informations Commerciales (Modifiables)</h3>
                
                <div class="form-group">
                    <label for="date_naissance">ğŸ“… Date de DÃ©but Relation</label>
                    <input type="date" id="date_naissance" name="date_naissance" value="{{ contact.date_naissance or '' }}">
                </div>
                
                <div class="form-group">
                    <label for="numero_secu">ğŸ¢ NÂ° SIRET/Client</label>
                    <input type="text" id="numero_secu" name="numero_secu" value="{{ contact.numero_secu or '' }}" maxlength="50" placeholder="NumÃ©ro d'identification">
                </div>
                
                <div class="form-group">
                    <label for="allergies">ğŸ­ Secteur d'ActivitÃ©</label>
                    <textarea id="allergies" name="allergies" rows="3" placeholder="Ex: SantÃ©, Technologie, Commerce, Services, Industrie">{{ contact.allergies or '' }}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="notes">ğŸ“ Notes</label>
                    <textarea id="notes" name="notes" rows="4" placeholder="Besoins spÃ©cifiques, historique des transactions, prÃ©fÃ©rences...">{{ contact.notes or '' }}</textarea>
                </div>
                
                {% else %}
                <h3>Informations ComplÃ©mentaires (Modifiables)</h3>
                
                <div class="form-group">
                    <label for="notes">ğŸ“ Notes</label>
                    <textarea id="notes" name="notes" rows="6" placeholder="Ajoutez ici toutes les informations importantes...">{{ contact.notes or '' }}</textarea>
                </div>
                {% endif %}
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">âœ“ Mettre Ã  jour mes informations</button>
                </div>
            </form>
        </div>
        {% endif %}
        
        <div class="profile-actions">
            <h2>ğŸ”‘ Modifier le Mot de Passe</h2>
            <form method="POST" action="{{ url_for('profile') }}">
                <input type="hidden" name="action" value="password">
                
                <div class="form-group">
                    <label for="new_password">Nouveau mot de passe *</label>
                    <input type="password" id="new_password" name="new_password" required minlength="8">
                    <small>Minimum 8 caractÃ¨res (sÃ©curitÃ© renforcÃ©e)</small>
                </div>
                
                <div class="form-group">
                    <label for="confirm_password">Confirmer le mot de passe *</label>
                    <input type="password" id="confirm_password" name="confirm_password" required minlength="8">
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">âœ“ Changer le mot de passe</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
